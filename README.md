# Electricity Consumption and Production Management Software

This project is a web application designed to support the management of renewable energy generation from solar panels. It allows clients to register their installations, technicians to certify them, and operations managers to monitor energy production and manage energy credits.

This project is being developed for the Web Programming course.

## Table of Contents
- [Project Description](#project-description)
- [Functional Requirements](#functional-requirements)
- [System Architecture](#system-architecture)
- [Technologies Used](#technologies-used)
- [Getting Started](#getting-started)
  - [Prerequisites](#prerequisites)
  - [Setup and Execution](#setup-and-execution)
- [Project Structure](#project-structure)
- [Sprint Plan](#sprint-plan)

## Project Description

The primary goal of this application is to provide a comprehensive platform for managing solar energy production. The system facilitates interactions between three main user roles:
-   **Clients:** Owners of solar panel installations.
-   **Technicians:** Certified professionals who validate installations.
-   **Operations Managers:** Company employees who oversee energy production and credits.

## Functional Requirements

The application implements the following features, broken down by sprints:

### Sprint 1: Authentication
-   **User Authentication:** Secure user login using JSON Web Tokens (JWT).
-   **Role-Based Access Control:** The application's features are restricted based on user roles (Client, Technician, Operations Manager). The user's role is embedded in the JWT payload.
-   **Session Management:** The JWT is stored on the client-side (`sessionStorage`) to maintain the user session.

### Sprint 2: Installation and Certificate Management
-   **Installation Registration (Client Role):** Clients can fill out a form to register their solar panel installations, providing technical data and location details.
-   **Certificate Validation and Upload (Technician Role):** Technicians can search for client installations, review the details, and upload an official energy producer certificate (.pdf) upon validation.

### Sprint 3: Energy Monitoring & Credit Accounting
-   **Energy Production Monitoring (Operations Manager Role):** Operations Managers can monitor a client's real-time energy generation. The data is fetched from a mock API that simulates readings from a client's system.
-   **Energy Credit Accounting:** The system processes the energy generated by customers to calculate energy credits for any surplus. These credits can be used to offset future electricity bills.

## System Architecture

The application is composed of three main services that run concurrently: a frontend application, a main backend server, and a mock API for customer data.

1.  **Frontend (React):** The user interface that clients, technicians, and managers interact with. It makes API requests to the main backend.
2.  **Main Backend (Node.js/Express):** Handles business logic, user authentication, and data persistence. It communicates with the MongoDB database and the Mock Customer API.
3.  **Mock Customer API (Node.js/Express):** A separate service that simulates the real-world API of a customer's energy monitoring hardware. It provides random energy production data when requested by the main backend.
4.  **Database (MongoDB):** Stores all application data, including user credentials, installation details, and energy credit records.

![System Architecture Diagram](/docs/image.png)

## Technologies Used

-   **Backend:** Node.js, Express.js
-   **Frontend:** React, Material-UI, HTML, CSS, JavaScript
-   **Database:** MongoDB
-   **Authentication:** JSON Web Tokens (JWT)
-   **API Communication:** Axios

## Getting Started

Follow these instructions to set up and run the project on your local machine.

### Prerequisites

-   [Node.js](https://nodejs.org/) (which includes npm)
-   [MongoDB](https://www.mongodb.com/try/download/community) (or a MongoDB Atlas account)
-   [Git](https://git-scm.com/)

### Setup and Execution

Follow these steps to get the project running.

**1. Environment Variables**

Before starting, you need to create a `.env` file inside the `backend` directory. This file will store your database connection string and JWT secret.

Navigate to the `/backend` directory, create a `.env` file, and add the following content, replacing the placeholders with your actual configuration:

```
# backend/.env

MONGO_URI=mongodb://localhost:27017/web-project
JWT_SECRET=your_super_secret_key
PORT=5001
```

**2. Install Dependencies**

From the root of the project, run the following command to install all necessary dependencies for the backend, frontend, and mock API:

```bash
npm install
```

**3. Seed the Database**

To populate the database with initial user data (Client, Technician, Manager), run the seed script from the project root. You only need to do this once.

```bash
npm run seed
```

**4. Run the Application**

To start the backend server, frontend application, and mock API concurrently, run the following command from the project root:

```bash
npm run dev
```

The services will be available at the following addresses:
- **Frontend:** `http://localhost:3000`
- **Backend:** `http://localhost:5001`
- **Mock API:** `http://localhost:5002`

### Testing the API with Postman

You can use [Postman](https://www.postman.com/) to test the backend API endpoints directly. This is useful for debugging or verifying logic without needing the frontend.

**Base URL:** `http://localhost:5001`

**Authentication**

Before accessing protected routes, you must authenticate to get a JSON Web Token (JWT).

1.  **Login:** Send a `POST` request to `/api/auth/login`. In the request body, provide the credentials of a user that you have pre-loaded into the database.

    **Request Body (`application/json`):**
    ```json
    {
        "email": "client@example.com",
        "password": "password123"
    }
    ```

2.  **Get Token:** If the credentials are valid, the API will return a JWT in the response. Copy this token.

3.  **Set Authorization Header:** For all subsequent requests to protected endpoints, you need to include an `Authorization` header.
    - **Key:** `Authorization`
    - **Value:** `Bearer <your_jwt_token>`

    In Postman, you can set this in the **Authorization** tab by selecting **Bearer Token** and pasting your token.

**Example Endpoints by Role**

Remember to replace placeholders like `:id` and `:idClient` with actual IDs from your MongoDB database.

#### **Client Role**
-   **Register a new solar panel installation**
    -   **Endpoint:** `POST /api/installations`
    -   **Auth:** Required (Client JWT)
    -   **Body:**
        ```json
        {
            "clientId": "your_client_id_from_db",
            "technicalData": "Example: 20x 450W panels, 9kW total capacity",
            "location": "123 Solar St, Power City"
        }
        ```

#### **Technician Role**
-   **Get all installation records**
    -   **Endpoint:** `GET /api/installations`
    -   **Auth:** Required (Technician JWT)
-   **Get a specific installation by ID**
    -   **Endpoint:** `GET /api/installations/:id`
    -   **Auth:** Required (Technician JWT)
-   **Validate an installation**
    -   **Endpoint:** `PUT /api/installations/validate/:id`
    -   **Auth:** Required (Technician JWT)
-   **Upload a certificate for an installation**
    -   **Endpoint:** `POST /api/installations/certificate/:id`
    -   **Auth:** Required (Technician JWT)
    -   **Body:** Use `form-data` to upload the PDF file.

#### **Operations Manager Role**
-   **Monitor energy production for a client**
    -   **Endpoint:** `GET /api/production/:idClient`
    -   **Auth:** Required (Operations Manager JWT)

**Note on User Data**

As specified in the project requirements, there is no user registration feature. You must manually add users with different roles (Client, Technician, Operations Manager) to your MongoDB database to test the role-based access control.

## Project Structure
```
Web-Programming-Final-Project/
├── backend/                # Main backend server (Node.js/Express)
├── frontend/               # Frontend application (React)
├── mock-customer-api/      # Mock API for energy data (Node.js/Express)
├── docs/                   # Documentation files
│   ├── BACKLOG.md          # Project history and commands log
│   ├── FinalReport.md      # Final project report with implementation details and conclusions
│   ├── Sprint1.md          # Details for Sprint 1
│   ├── Sprint2.md          # Details for Sprint 2
│   ├── Sprint3.md          # Details for Sprint 3
│   ├── TODO.md             # Project task list
│   ├── Trabalho_Final_PW.md # Original project requirements
│   └── image.png               # System architecture diagram
└── README.md               # This file
```

## Sprint Plan

The project is organized into three sprints, as detailed in the corresponding markdown files:
-   **[Sprint1.md](./docs/Sprint1.md):** Authentication Feature.
-   **[Sprint2.md](./docs/Sprint2.md):** Solar Panel Installation and Certificate Registration.
-   **[Sprint3.md](./docs/Sprint3.md):** Energy Production Monitoring and Credit Accounting.

The overall project requirements and goals are defined in [`docs/Trabalho_Final_PW.md`](./docs/Trabalho_Final_PW.md).
The development task list is tracked in [`docs/TODO.md`](./docs/TODO.md).
The project history and backlog are tracked in [`docs/BACKLOG.md`](./docs/BACKLOG.md). 
